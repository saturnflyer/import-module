<?xml version="1.0" ?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<link rel="stylesheet" type="text/css" href="../doc/style.css" />
<title>README-ja.rd</title>
</head>
<body>
<h1><a name="label-0" id="label-0">import-module</a></h1><!-- RDLabel: "import-module" -->
<p>2005.02.02</p>
<ul>
<li>Version: 0.82</li>
<li>著者: 原　信一郎</li>
<li>メール: sinara@blade.nagaokaut.ac.jp</li>
<li>ホームページ: <a href="http://blade.nagaokaut.ac.jp/~sinara/ruby/import-module/">&lt;URL:http://blade.nagaokaut.ac.jp/~sinara/ruby/import-module/&gt;</a></li>
</ul>
<h2><a name="label-1" id="label-1">紹介</a></h2><!-- RDLabel: "紹介" -->
<p>import-module はモジュールのインクルードを動的に行います。</p>
<h2><a name="label-2" id="label-2">インストール</a></h2><!-- RDLabel: "インストール" -->
<p>ユニックス系の OS ならば</p>
<pre>ruby install.rb</pre>
<p>としてください。また、 lib/*.rb を、ruby が require できる場所に
コピーしても構いません。</p>
<h2><a name="label-3" id="label-3">用法</a></h2><!-- RDLabel: "用法" -->
<p><code>reqruire "import-method"</code>をすると<var>Module</var>に以下のメソッドが
付け加えられます。</p>
<dl>
<dt><a name="label-4" id="label-4"><code>import_module(<var>mod</var>) { ... }</code></a></dt><!-- RDLabel: "import_module" -->
<dd>
<p><var>mod</var> をモジュールとして取り込んだ状態で ... を実行します。</p>
<p>(例)</p>
<pre>require "import-module"
class Foo
  def hello
    puts 'hello'
  end
end

module Bar
  def hello
    puts 'bye'
  end
end

module Baz
  def hello
    puts 'good-bye'
  end
end

foo = Foo.new
foo.hello                   #=&gt; hello
Foo.import_module(Bar) do
  foo.hello                 #=&gt; bye
  Foo.import_module(Baz) do
    foo.hello               #=&gt; good-bye
  end
  foo.hello                 #=&gt; bye
end
foo.hello                   #=&gt; hello</pre></dd>
<dt><a name="label-5" id="label-5"><code>adopt_module(<var>mod</var>)</code></a></dt><!-- RDLabel: "adopt_module" -->
<dd>
<p><var>mod</var> をモジュールとして取り込みます。</p>
<p>(例)</p>
<pre>require "import-module"
class Foo
  def hello
    puts 'hello'
  end
end

module Bar
  def hello
    puts 'bye'
  end
end

foo = Foo.new
Foo.adopt_module(Bar)
foo.hello                 #=&gt; bye</pre></dd>
</dl>
<p>また、<var>Object</var>には次のメソッドが付け加わります。</p>
<dl>
<dt><a name="label-6" id="label-6"><code>import(<var>mod</var>) { ... }</code></a></dt><!-- RDLabel: "import" -->
<dd>
<p>オブジェクトに <var>mod</var> をモジュールとして取り込んだ状態で ... を実行します。</p>
<p>(例)</p>
<pre>require "import-module"
class Foo
  def hello
    puts 'hello'
  end
end

module Bar
  def hello
    puts 'bye'
  end
end

foo = Foo.new
bar = Foo.new
foo.hello                   #=&gt; hello
bar.hello                   #=&gt; hello
foo.import(Bar) do |foo0|
  foo.hello                 #=&gt; bye
  p foo == foo0             #=&gt; true
  bar.hello                 #=&gt; hello
end
foo.hello                   #=&gt; hello
bar.hello                   #=&gt; hello</pre></dd>
<dt><a name="label-7" id="label-7"><code>adopt(<var>mod</var>)</code></a></dt><!-- RDLabel: "adopt" -->
<dd>
<p>オブジェクトに <var>mod</var> をモジュールとして取り込みます。</p>
<p>(例)</p>
<pre>require "import-module"
class Foo
  def hello
    puts 'hello'
  end
end

module Bar
  def hello
    puts 'bye'
  end
end

foo = Foo.new
bar = Foo.new
foo.adopt(Bar)
foo.hello                   #=&gt; bye
bar.hello                   #=&gt; hello</pre></dd>
</dl>
<h2><a name="label-8" id="label-8">マルチスレッド</a></h2><!-- RDLabel: "マルチスレッド" -->
<p>このライブラリはマルチスレッド対応しています。</p>
<p>(例)</p>
<pre>require "import-module"
class Foo
  def hello
    puts 'hello'
  end
end

module Bar
  def hello
    puts 'bye'
  end
end

foo = Foo.new
foo.hello #=&gt; hello
Thread.start do
  Foo.import_module(Bar) do
    foo.hello #=&gt; bye
  end
end
foo.hello #=&gt; hello</pre>
<p>マルチスレッド対応が必要でない場合は、
<code>$import_module_single_thread = true</code> としてから
<code>import-module.rb</code> を require するか、
<code>import-module.rb</code> ではなく、
<code>import-module-single-thread.rb</code> を require してください。
メソッドの呼び出しが早くなります。</p>
<h2><a name="label-9" id="label-9">使い道の例</a></h2><!-- RDLabel: "使い道の例" -->
<h3><a name="label-10" id="label-10">Modify Enumerable</a></h3><!-- RDLabel: "Modify Enumerable" -->
<p>Enumerable の一時的な変更</p>
<pre>require "import-module"
module EachChar
 def each(&amp;b); split(//).each(&amp;b); end
end
p "abc".import(EachChar){|s| s.map{|x| x.succ}}.join("") #=&gt; "bcd"</pre>
<h3><a name="label-11" id="label-11">Determinant</a></h3><!-- RDLabel: "Determinant" -->
<p>整数値行列をそのまま有理数値行列として扱う。</p>
<pre>require "import-module"
require "matrix"
require "rational"

module RationalDiv
  def /(other)
    Rational(self) / other
  end
end

a = Matrix[[2, 1], [3, 1]]
puts a.det   #=&gt; 0
Fixnum.import_module(RationalDiv) do
  puts a.det #=&gt; -1
end
puts a.det   #=&gt; 0</pre>
<h2><a name="label-12" id="label-12">参考</a></h2><!-- RDLabel: "参考" -->
<p>RAA <a href="http://www.ruby-lang.org/en/raa.html">&lt;URL:http://www.ruby-lang.org/en/raa.html&gt;</a> における以下のプログラムを参
考にしました。</p>
<ul>
<li>Ruby Behaviors (David Alan Black)</li>
<li>scope-in-state (Keiju Ishitsuka)</li>
<li>class-in-state (Keiju Ishitsuka)</li>
</ul>
<h2><a name="label-13" id="label-13">履歴</a></h2><!-- RDLabel: "履歴" -->
<p>0.82 (2005.02.02)</p>
<ul>
<li>id =&gt; object_id</li>
</ul>
<p>0.81 (2004.03.10)</p>
<ul>
<li>再パッケージ</li>
</ul>
<p>0.80 (2003.06.29)</p>
<ul>
<li>adapted to 1.8.0(preview3)</li>
<li>adapted to 1.6.8</li>
</ul>
<p>0.79 (2003.05.02)</p>
<ul>
<li>$import_module_single_thread 導入</li>
<li>install.rb 添付</li>
</ul>
<p>0.78 (2003.05.01)</p>
<ul>
<li>メソッドの可視性の保存について bug fix</li>
</ul>
<p>0.77 (2002.11.05)</p>
<ul>
<li>proxy object を Hash から Array に変更し高速化</li>
</ul>
<p>0.76 (2002.11.01)</p>
<ul>
<li>可視性(protected)の保存</li>
</ul>
<p>0.75 (2002.10.31)</p>
<ul>
<li>set_orig_method 導入</li>
</ul>
<p>0.74 (2002.10.30)</p>
<ul>
<li>Stack#update から Scope#update へ移動</li>
<li>Stack#export_current 導入</li>
<li>test, test-import-module.rb test-time.rb 書き換え</li>
</ul>
<p>0.73 (2002.10.28)</p>
<ul>
<li>Stack 変更</li>
<li>ImportModule#import_module_init 廃止</li>
<li>Thread#__IMPORT_MODULE_PREFIX_proxy, stack 導入</li>
<li>test scripts 改変</li>
</ul>
<p>0.72 (2002.10.22)</p>
<ul>
<li>Import_Module::Scope.create 導入</li>
<li>Scope_Module 廃止</li>
</ul>
<p>0.71 (2002.10.20)</p>
<ul>
<li>Scope_Module クラス導入</li>
<li>optimize: &amp;b -&gt; b -&gt; b -&gt; &amp;b</li>
<li>import-module-single-thread.rb 分離</li>
<li>Import_Module.single_thread 廃止</li>
</ul>
<p>0.70 (2002.10.17)</p>
<ul>
<li>Scope クラス導入</li>
<li>import-module-pip.rb</li>
<li>import-moudle-unbound-method.rb</li>
</ul>
<p>0.60 (2002.10.15)</p>
<ul>
<li>クラス Target, Source, Stack に分割</li>
</ul>
<p>0.60beta6 (2002.10.15)</p>
<ul>
<li>代理継承パターン利用の最後</li>
</ul>
<p>0.52 (2002.10.10)</p>
<ul>
<li>ターゲットのメソッドを再定義する方式に</li>
<li>thread safe mode をデフォルトに</li>
<li>thread_safe メソッドを廃止</li>
<li>single_thread_mode メソッドを追加</li>
</ul>
<p>0.51 (2002.10.09)</p>
<ul>
<li>メソッドのパラメータの展開・集約の抑制 (Import_Module)</li>
</ul>
<p>0.50 (2002.10.03)</p>
<ul>
<li>scope-in-state の代理継承パターンの取り入れ (Import_Module)</li>
<li>stack を alias ベースからモジュールの配列ベースに変更 (Import_Module_Single_Thread)</li>
<li>$IMPORT_MODULE_thread_safe の廃止</li>
<li>Import_Module.thread_safe の導入</li>
<li>Super 機能中止</li>
</ul>

</body>
</html>
